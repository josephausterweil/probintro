<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="From Simulation to Inference So far, we‚Äôve used GenJAX to generate outcomes ‚Äî simulating what could happen.
Now we‚Äôll learn to infer ‚Äî reasoning backwards from observations to causes.
This is the heart of probabilistic programming!
Recall: Conditional Probability From the probability tutorial, remember conditional probability:
‚ÄúGiven that I observed $B$, what‚Äôs the probability of $A$?‚Äù
Written: $P(A \mid B)$">
    <meta name="author" content="Joseph Austerweil">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Conditioning and Observations :: Probability & Probabilistic Computing Tutorial">
    <meta name="twitter:description" content="From Simulation to Inference So far, we‚Äôve used GenJAX to generate outcomes ‚Äî simulating what could happen.
Now we‚Äôll learn to infer ‚Äî reasoning backwards from observations to causes.
This is the heart of probabilistic programming!
Recall: Conditional Probability From the probability tutorial, remember conditional probability:
‚ÄúGiven that I observed $B$, what‚Äôs the probability of $A$?‚Äù
Written: $P(A \mid B)$">
    <meta property="og:url" content="https://josephausterweil.github.io/probintro/genjax/04_conditioning/index.html">
    <meta property="og:site_name" content="Probability & Probabilistic Computing Tutorial">
    <meta property="og:title" content="Conditioning and Observations :: Probability & Probabilistic Computing Tutorial">
    <meta property="og:description" content="From Simulation to Inference So far, we‚Äôve used GenJAX to generate outcomes ‚Äî simulating what could happen.
Now we‚Äôll learn to infer ‚Äî reasoning backwards from observations to causes.
This is the heart of probabilistic programming!
Recall: Conditional Probability From the probability tutorial, remember conditional probability:
‚ÄúGiven that I observed $B$, what‚Äôs the probability of $A$?‚Äù
Written: $P(A \mid B)$">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Probabilistic Programming with GenJAX">
    <meta itemprop="name" content="Conditioning and Observations :: Probability & Probabilistic Computing Tutorial">
    <meta itemprop="description" content="From Simulation to Inference So far, we‚Äôve used GenJAX to generate outcomes ‚Äî simulating what could happen.
Now we‚Äôll learn to infer ‚Äî reasoning backwards from observations to causes.
This is the heart of probabilistic programming!
Recall: Conditional Probability From the probability tutorial, remember conditional probability:
‚ÄúGiven that I observed $B$, what‚Äôs the probability of $A$?‚Äù
Written: $P(A \mid B)$">
    <meta itemprop="wordCount" content="2628">
    <title>Conditioning and Observations :: Probability &amp; Probabilistic Computing Tutorial</title>
    <link href="/probintro/images/favicon.png?1763027978" rel="icon" type="image/png">
    <link href="/probintro/css/auto-complete/auto-complete.min.css?1763027978" rel="stylesheet">
    <script src="/probintro/js/auto-complete/auto-complete.min.js?1763027978" defer></script>
    <script src="/probintro/js/search-lunr.min.js?1763027978" defer></script>
    <script src="/probintro/js/search.min.js?1763027978" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/probintro/searchindex.en.js?1763027978";
    </script>
    <script src="/probintro/js/lunr/lunr.min.js?1763027978" defer></script>
    <script src="/probintro/js/lunr/lunr.stemmer.support.min.js?1763027978" defer></script>
    <script src="/probintro/js/lunr/lunr.multi.min.js?1763027978" defer></script>
    <script src="/probintro/js/lunr/lunr.en.min.js?1763027978" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/probintro/fonts/fontawesome/css/fontawesome-all.min.css?1763027978" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/probintro/fonts/fontawesome/css/fontawesome-all.min.css?1763027978" rel="stylesheet"></noscript>
    <link href="/probintro/css/perfect-scrollbar/perfect-scrollbar.min.css?1763027978" rel="stylesheet">
    <link href="/probintro/css/theme.min.css?1763027978" rel="stylesheet">
    <link href="/probintro/css/format-html.min.css?1763027978" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/genjax\/04_conditioning\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/josephausterweil.github.io\/probintro';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'relearn-dark' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>

<link rel="stylesheet" href="/probintro/css/custom.css">

  </head>
  <body class="mobile-support html" data-url="/probintro/genjax/04_conditioning/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#from-simulation-to-inference">From Simulation to Inference</a></li>
    <li><a href="#recall-conditional-probability">Recall: Conditional Probability</a></li>
    <li><a href="#example-from-set-based-probability">Example from Set-Based Probability</a></li>
    <li><a href="#conditional-probability-in-genjax">Conditional Probability in GenJAX</a>
      <ul>
        <li><a href="#approach-1-filtering-simulations-rejection-sampling">Approach 1: Filtering Simulations (Rejection Sampling)</a></li>
        <li><a href="#approach-2-conditioning-with-generate">Approach 2: Conditioning with <code>generate</code></a></li>
        <li><a href="#approach-3-full-inference-importance-sampling-mcmc">Approach 3: Full Inference (Importance Sampling, MCMC)</a></li>
      </ul>
    </li>
    <li><a href="#approach-1-filtering-simulations">Approach 1: Filtering Simulations</a>
      <ul>
        <li><a href="#step-1-generate-many-traces">Step 1: Generate Many Traces</a></li>
        <li><a href="#step-2-filter-to-observation">Step 2: Filter to Observation</a></li>
        <li><a href="#step-3-query-among-filtered-traces">Step 3: Query Among Filtered Traces</a></li>
        <li><a href="#step-4-calculate-conditional-probability">Step 4: Calculate Conditional Probability</a></li>
      </ul>
    </li>
    <li><a href="#complete-example-filtering">Complete Example: Filtering</a></li>
    <li><a href="#approach-2-conditioning-with-choice-maps">Approach 2: Conditioning with Choice Maps</a>
      <ul>
        <li><a href="#creating-a-choice-map">Creating a Choice Map</a></li>
        <li><a href="#generating-with-observations">Generating with Observations</a></li>
      </ul>
    </li>
    <li><a href="#generating-multiple-conditional-traces">Generating Multiple Conditional Traces</a></li>
    <li><a href="#connection-to-the-probability-tutorial">Connection to the Probability Tutorial</a>
      <ul>
        <li><a href="#the-generative-model">The Generative Model</a></li>
        <li><a href="#prior-before-hearing-the-clue">Prior (Before Hearing the Clue)</a></li>
        <li><a href="#posterior-after-hearing-t">Posterior (After Hearing &ldquo;T&rdquo;)</a></li>
      </ul>
    </li>
    <li><a href="#visualizing-prior-vs-posterior">Visualizing Prior vs Posterior</a></li>
    <li><a href="#key-concepts">Key Concepts</a>
      <ul>
        <li><a href="#prior-distribution">Prior Distribution</a></li>
        <li><a href="#posterior-distribution">Posterior Distribution</a></li>
        <li><a href="#bayes-theorem-in-action">Bayes&rsquo; Theorem in Action</a></li>
      </ul>
    </li>
    <li><a href="#exercises">Exercises</a>
      <ul>
        <li><a href="#exercise-1-independent-variables">Exercise 1: Independent Variables</a></li>
        <li><a href="#exercise-2-dependent-variables">Exercise 2: Dependent Variables</a></li>
        <li><a href="#exercise-3-multiple-observations">Exercise 3: Multiple Observations</a></li>
      </ul>
    </li>
    <li><a href="#what-youve-learned">What You&rsquo;ve Learned</a></li>
    <li><a href="#next-steps">Next Steps</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/probintro/index.html"><span itemprop="name">Probability &amp; Probabilistic Computing Tutorial</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/probintro/genjax/index.html"><span itemprop="name">Probabilistic Programming with GenJAX</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Conditioning and Observations</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/probintro/genjax/03_traces/index.html" title="Understanding Traces (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/probintro/genjax/05_inference/index.html" title="Inference in Action: The Taxicab Problem (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable genjax" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="conditioning-and-observations">Conditioning and Observations</h1>

<h2 id="from-simulation-to-inference">From Simulation to Inference</h2>
<p>So far, we&rsquo;ve used GenJAX to <strong>generate</strong> outcomes ‚Äî simulating what could happen.</p>
<p>Now we&rsquo;ll learn to <strong>infer</strong> ‚Äî reasoning backwards from observations to causes.</p>
<p>This is the heart of probabilistic programming!</p>
<p><a href="#R-image-e85cba399167c86ce4819779fb5accea" class="lightbox-link"><img alt="Chibany thinking" class="lazy lightbox figure-image" loading="lazy" src="/probintro/images/chibanylayingdown.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e85cba399167c86ce4819779fb5accea"><img alt="Chibany thinking" class="lazy lightbox lightbox-image" loading="lazy" src="/probintro/images/chibanylayingdown.png"></a></p>
<hr>
<h2 id="recall-conditional-probability">Recall: Conditional Probability</h2>
<p>From the probability tutorial, remember <strong>conditional probability</strong>:</p>
<blockquote>
<p><strong>&ldquo;Given that I observed $B$, what&rsquo;s the probability of $A$?&rdquo;</strong></p></blockquote>
<p><strong>Written:</strong> $P(A \mid B)$</p>
<p><strong>Meaning:</strong> Restrict the outcome space to only outcomes in $B$, then calculate the probability of $A$ within that restricted space.</p>
<p><strong>Formula:</strong> $P(A \mid B) = \frac{P(A \cap B)}{P(B)} = \frac{|A \cap B|}{|B|}$</p>
<hr>
<h2 id="example-from-set-based-probability">Example from Set-Based Probability</h2>
<p>Chibany&rsquo;s meals: $\Omega = \{HH, HT, TH, TT\}$</p>
<p><strong>Question:</strong> &ldquo;Given that dinner is Tonkatsu, what&rsquo;s the probability lunch was also Tonkatsu?&rdquo;</p>
<p><strong>Set-based solution:</strong></p>
<ol>
<li>Observe $D$ = &ldquo;dinner is Tonkatsu&rdquo; = $\{HT, TT\}$</li>
<li>Want $L$ = &ldquo;lunch is Tonkatsu&rdquo; = $\{TH, TT\}$</li>
<li>Intersection: $L \cap D = \{TT\}$</li>
<li>Conditional probability: $P(L \mid D) = \frac{|\{TT\}|}{|\{HT, TT\}|} = \frac{1}{2}$</li>
</ol>
<p><strong>Key insight:</strong> We <strong>restricted the outcome space</strong> from $\{HH, HT, TH, TT\}$ to just $\{HT, TT\}$ (outcomes where dinner = Tonkatsu).</p>

<details open class=" box cstyle notices info">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-info-circle"></i> 
    üìò Foundation Concept: Conditioning as Restriction
  </summary>
  <div class="box-content">
<p><strong>Recall from Tutorial 1, Chapter 4</strong> that conditional probability means <strong>restricting the outcome space</strong>:</p>
<p>$$P(A \mid B) = \frac{|A \cap B|}{|B|}$$</p>
<p><strong>The key idea:</strong> Cross out outcomes where $B$ didn&rsquo;t happen, then calculate probabilities in what remains.</p>
<p><strong>Tutorial 1 example:</strong> &ldquo;At least one tonkatsu&rdquo; given &ldquo;first meal was tonkatsu&rdquo;</p>
<ul>
<li>Original space: {HH, HT, TH, TT}</li>
<li>Condition: First meal is T ‚Üí Restrict to {TH, TT}</li>
<li>Event: At least one T ‚Üí In restricted space: {TH, TT}</li>
<li>Probability: 2/2 = 1 (both remaining outcomes have tonkatsu!)</li>
</ul>
<p><strong>What GenJAX does:</strong></p>
<ul>
<li>Tutorial 1: Manually cross out outcomes and count</li>
<li>Tutorial 2: Code filters simulations or uses <code>ChoiceMap</code> to restrict</li>
</ul>
<p><strong>The logic is identical</strong> ‚Äî conditioning = restricting possibilities to match observations!</p>
<p><a href="/probintro/intro/04_conditional/index.html">‚Üê Review conditional probability in Tutorial 1, Chapter 4</a></p>
  </div>
</details>
<hr>
<h2 id="conditional-probability-in-genjax">Conditional Probability in GenJAX</h2>
<p>In GenJAX, we do the same thing ‚Äî but with <strong>code instead of sets</strong>!</p>
<p><strong>Three approaches:</strong></p>
<h3 id="approach-1-filtering-simulations-rejection-sampling">Approach 1: Filtering Simulations (Rejection Sampling)</h3>
<p>Generate many traces, keep only those matching the observation.</p>
<p><strong>Pseudocode:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>1. Generate many traces
2. Keep only traces where observation is true
3. Among those, count how many satisfy the query
4. Calculate the ratio</code></pre></div>
<p>This is <strong>Monte Carlo conditional probability</strong> ‚Äî exactly what we did by hand with sets!</p>
<h3 id="approach-2-conditioning-with-generate">Approach 2: Conditioning with <code>generate</code></h3>
<p>GenJAX has built-in support for specifying observations. We provide a <strong>choice map</strong> with the observed values, and GenJAX generates traces consistent with those observations.</p>
<h3 id="approach-3-full-inference-importance-sampling-mcmc">Approach 3: Full Inference (Importance Sampling, MCMC)</h3>
<p>More advanced methods that we&rsquo;ll explore in Chapter 5. These are more efficient when observations are rare.</p>
<p><strong>This chapter focuses on Approach 1 and 2</strong> ‚Äî the most intuitive methods.</p>

<details open class=" box cstyle notices " style=";--VARIABLE-BOX-color: success">
  <summary class="box-label" tabindex="-1">
    üìê‚Üíüíª Math-to-Code Translation
  </summary>
  <div class="box-content">
<p><strong>How conditional probability translates to GenJAX:</strong></p>
<table>
  <thead>
      <tr>
          <th>Math Concept</th>
          <th>Mathematical Notation</th>
          <th>GenJAX Code</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Conditional Probability</strong></td>
          <td>$P(A \mid B)$</td>
          <td><code>Target(model, (), observations)</code></td>
      </tr>
      <tr>
          <td><strong>Observation</strong></td>
          <td>$B$ = &ldquo;dinner is T&rdquo;</td>
          <td><code>ChoiceMap.d({&quot;dinner&quot;: 1})</code></td>
      </tr>
      <tr>
          <td><strong>Query</strong></td>
          <td>$A$ = &ldquo;lunch is T&rdquo;</td>
          <td>Check <code>trace[&quot;lunch&quot;] == 1</code></td>
      </tr>
      <tr>
          <td><strong>Restriction</strong></td>
          <td>Cross out outcomes where $B$ is false</td>
          <td>Filter traces or use <code>Target</code></td>
      </tr>
  </tbody>
</table>
<p><strong>The three approaches:</strong></p>
<table>
  <thead>
      <tr>
          <th>Approach</th>
          <th>Math Equivalent</th>
          <th>GenJAX Implementation</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>1. Filtering</strong></td>
          <td>Keep only outcomes in $B$, count $A$</td>
          <td><code>traces[condition]</code> + count</td>
      </tr>
      <tr>
          <td><strong>2. ChoiceMap</strong></td>
          <td>Specify $B$ directly</td>
          <td><code>Target(model, (), observations)</code></td>
      </tr>
      <tr>
          <td><strong>3. Inference</strong></td>
          <td>Weighted sampling from $P(A\mid B)$</td>
          <td><code>target.importance(key, ...)</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Key insight:</strong> All three compute the same conditional probability‚Äîthey just differ in efficiency and how explicitly you specify the condition.</p>
  </div>
</details>
<hr>
<h2 id="approach-1-filtering-simulations">Approach 1: Filtering Simulations</h2>
<p>Let&rsquo;s answer: <strong>&ldquo;Given dinner is Tonkatsu, what&rsquo;s P(lunch is Tonkatsu)?&rdquo;</strong></p>
<h3 id="step-1-generate-many-traces">Step 1: Generate Many Traces</h3>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> jax
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jax.numpy <span style="color:#66d9ef">as</span> jnp
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> genjax <span style="color:#f92672">import</span> gen, bernoulli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@gen</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chibany_day</span>():
</span></span><span style="display:flex;"><span>    lunch_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;lunch&#34;</span>
</span></span><span style="display:flex;"><span>    dinner_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;dinner&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (lunch_is_tonkatsu, dinner_is_tonkatsu)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate 10,000 days</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_one_day</span>(k):
</span></span><span style="display:flex;"><span>    trace <span style="color:#f92672">=</span> chibany_day<span style="color:#f92672">.</span>simulate(k, ())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>days <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_one_day)(keys)</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="step-2-filter-to-observation">Step 2: Filter to Observation</h3>
<p><strong>Observation:</strong> Dinner is Tonkatsu (dinner = 1)</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Filter: keep only days where dinner is Tonkatsu</span>
</span></span><span style="display:flex;"><span>dinner_is_tonkatsu <span style="color:#f92672">=</span> days[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Count how many days match</span>
</span></span><span style="display:flex;"><span>n_matching <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum(dinner_is_tonkatsu)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Days where dinner is Tonkatsu: </span><span style="color:#e6db74">{</span>n_matching<span style="color:#e6db74">}</span><span style="color:#e6db74"> / </span><span style="color:#e6db74">{</span>len(days)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output (example):</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Days where dinner is Tonkatsu: 4982 / 10000</code></pre></div>
<p><strong>This is about 50%</strong> ‚Äî makes sense because dinner has 50% probability!</p>
<h3 id="step-3-query-among-filtered-traces">Step 3: Query Among Filtered Traces</h3>
<p>Among days where dinner is Tonkatsu, how many also have lunch as Tonkatsu?</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Both meals are Tonkatsu</span>
</span></span><span style="display:flex;"><span>both_tonkatsu <span style="color:#f92672">=</span> (days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> (days[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Count</span>
</span></span><span style="display:flex;"><span>n_both <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum(both_tonkatsu)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Days with both Tonkatsu: </span><span style="color:#e6db74">{</span>n_both<span style="color:#e6db74">}</span><span style="color:#e6db74"> / </span><span style="color:#e6db74">{</span>n_matching<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output (example):</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Days with both Tonkatsu: 2491 / 4982</code></pre></div>
<h3 id="step-4-calculate-conditional-probability">Step 4: Calculate Conditional Probability</h3>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>prob_lunch_given_dinner <span style="color:#f92672">=</span> n_both <span style="color:#f92672">/</span> n_matching
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(lunch=T | dinner=T) ‚âà </span><span style="color:#e6db74">{</span>prob_lunch_given_dinner<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>P(lunch=T | dinner=T) ‚âà 0.500</code></pre></div>
<p><strong>Perfect!</strong> This matches the theoretical answer (0.5) because lunch and dinner are independent.</p>
<hr>
<h2 id="complete-example-filtering">Complete Example: Filtering</h2>
<p>Here&rsquo;s the complete code:</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> jax
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jax.numpy <span style="color:#66d9ef">as</span> jnp
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> genjax <span style="color:#f92672">import</span> gen, bernoulli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@gen</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chibany_day</span>():
</span></span><span style="display:flex;"><span>    lunch_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;lunch&#34;</span>
</span></span><span style="display:flex;"><span>    dinner_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;dinner&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (lunch_is_tonkatsu, dinner_is_tonkatsu)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate simulations</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_one_day</span>(k):
</span></span><span style="display:flex;"><span>    trace <span style="color:#f92672">=</span> chibany_day<span style="color:#f92672">.</span>simulate(k, ())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>days <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_one_day)(keys)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Observation: dinner is Tonkatsu</span>
</span></span><span style="display:flex;"><span>observation_satisfied <span style="color:#f92672">=</span> days[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Query: lunch is also Tonkatsu</span>
</span></span><span style="display:flex;"><span>query_satisfied <span style="color:#f92672">=</span> days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Both observation AND query</span>
</span></span><span style="display:flex;"><span>both_satisfied <span style="color:#f92672">=</span> observation_satisfied <span style="color:#f92672">&amp;</span> query_satisfied
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate conditional probability</span>
</span></span><span style="display:flex;"><span>n_observation <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum(observation_satisfied)
</span></span><span style="display:flex;"><span>n_both <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum(both_satisfied)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>prob_conditional <span style="color:#f92672">=</span> n_both <span style="color:#f92672">/</span> n_observation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;=== Conditional Probability via Filtering ===&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Observation (dinner=T): </span><span style="color:#e6db74">{</span>n_observation<span style="color:#e6db74">}</span><span style="color:#e6db74"> traces&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Both (lunch=T AND dinner=T): </span><span style="color:#e6db74">{</span>n_both<span style="color:#e6db74">}</span><span style="color:#e6db74"> traces&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(lunch=T | dinner=T) ‚âà </span><span style="color:#e6db74">{</span>prob_conditional<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>

<details open class=" box cstyle notices " style=";--VARIABLE-BOX-color: success">
  <summary class="box-label" tabindex="-1">
    The Pattern
  </summary>
  <div class="box-content">
<p><strong>Conditional probability via filtering:</strong></p>
<ol>
<li><strong>Generate</strong> many traces</li>
<li><strong>Filter</strong> to observations (keep only matching traces)</li>
<li><strong>Count</strong> queries among filtered traces</li>
<li><strong>Divide</strong> to get conditional probability</li>
</ol>
<p>This is <strong>rejection sampling</strong> ‚Äî the simplest form of inference!</p>
  </div>
</details>
<hr>
<h2 id="approach-2-conditioning-with-choice-maps">Approach 2: Conditioning with Choice Maps</h2>
<p>GenJAX also lets you <strong>specify observations</strong> when generating traces.</p>
<h3 id="creating-a-choice-map">Creating a Choice Map</h3>
<p>A <strong>choice map</strong> is a dictionary specifying values for named random choices:</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> genjax <span style="color:#f92672">import</span> ChoiceMap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Specify that dinner must be Tonkatsu (1)</span>
</span></span><span style="display:flex;"><span>observations <span style="color:#f92672">=</span> ChoiceMap({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;dinner&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>})</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="generating-with-observations">Generating with Observations</h3>
<p>Use the <code>generate</code> function instead of <code>simulate</code>:</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate a trace consistent with observations</span>
</span></span><span style="display:flex;"><span>trace, weight <span style="color:#f92672">=</span> chibany_day<span style="color:#f92672">.</span>generate(key, (), observations)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Lunch: </span><span style="color:#e6db74">{</span>trace<span style="color:#f92672">.</span>get_choices()[<span style="color:#e6db74">&#39;lunch&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Dinner: </span><span style="color:#e6db74">{</span>trace<span style="color:#f92672">.</span>get_choices()[<span style="color:#e6db74">&#39;dinner&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Weight: </span><span style="color:#e6db74">{</span>weight<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output (example):</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Lunch: 1
Dinner: 1  # Always 1 because we observed it!
Weight: -0.6931471805599453</code></pre></div>
<p><strong>What&rsquo;s the weight?</strong> It&rsquo;s the log probability of the observation. Here, $P(\text{dinner}=1) = 0.5$, so $\log(0.5) = -0.693&hellip;$</p>

<details open class=" box cstyle notices info">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-info-circle"></i> 
    generate() vs simulate()
  </summary>
  <div class="box-content">
<p><strong><code>simulate(key, args)</code>:</strong></p>
<ul>
<li>Generates a trace with all choices random</li>
<li>No observations specified</li>
<li>Returns just the trace</li>
</ul>
<p><strong><code>generate(key, args, observations)</code>:</strong></p>
<ul>
<li>Generates a trace consistent with observations</li>
<li>Specified choices take given values</li>
<li>Unspecified choices are random</li>
<li>Returns <code>(trace, weight)</code> where weight = log probability of observations</li>
</ul>
<p><strong>When to use which:</strong></p>
<ul>
<li><strong>Forward simulation</strong> (no observations): Use <code>simulate()</code></li>
<li><strong>Conditional sampling</strong> (some observations): Use <code>generate()</code></li>
</ul>
  </div>
</details>
<hr>
<h2 id="generating-multiple-conditional-traces">Generating Multiple Conditional Traces</h2>
<p>Let&rsquo;s generate 1000 traces where dinner is Tonkatsu:</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> genjax <span style="color:#f92672">import</span> ChoiceMap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Observation: dinner = Tonkatsu</span>
</span></span><span style="display:flex;"><span>observations <span style="color:#f92672">=</span> ChoiceMap({<span style="color:#e6db74">&#34;dinner&#34;</span>: <span style="color:#ae81ff">1</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate many conditional traces</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_conditional</span>(k):
</span></span><span style="display:flex;"><span>    trace, weight <span style="color:#f92672">=</span> chibany_day<span style="color:#f92672">.</span>generate(k, (), observations)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>conditional_days <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_conditional)(keys)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Count lunch outcomes</span>
</span></span><span style="display:flex;"><span>lunch_tonkatsu <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum(conditional_days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Among </span><span style="color:#e6db74">{</span>len(conditional_days)<span style="color:#e6db74">}</span><span style="color:#e6db74"> days where dinner=Tonkatsu:&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Lunch is Tonkatsu: </span><span style="color:#e6db74">{</span>lunch_tonkatsu<span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">{</span>lunch_tonkatsu<span style="color:#f92672">/</span>len(conditional_days)<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  Lunch is Hamburger: </span><span style="color:#e6db74">{</span>len(conditional_days) <span style="color:#f92672">-</span> lunch_tonkatsu<span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">{</span>(len(conditional_days) <span style="color:#f92672">-</span> lunch_tonkatsu)<span style="color:#f92672">/</span>len(conditional_days)<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Among 1000 days where dinner=Tonkatsu:
  Lunch is Tonkatsu: 501 (50.1%)
  Lunch is Hamburger: 499 (49.9%)</code></pre></div>
<p><strong>Perfect!</strong> Confirms $P(\text{lunch}=T \mid \text{dinner}=T) = 0.5$</p>
<hr>
<h2 id="connection-to-the-probability-tutorial">Connection to the Probability Tutorial</h2>
<p>Let&rsquo;s revisit the exact example from Chapter 4 of the probability tutorial!</p>
<p><strong>Scenario:</strong> Chibany observes that the student bringing his lunch said &ldquo;He says it&rsquo;s from a place starting with T.&rdquo;</p>
<ul>
<li>If it&rsquo;s Tonkatsu, they&rsquo;d definitely say &ldquo;T&rdquo; (P = 1.0)</li>
<li>If it&rsquo;s Hamburger, they might still say &ldquo;T&rdquo; for &ldquo;The Burger Place&rdquo; (P = 0.3)</li>
</ul>
<p><strong>Question:</strong> What&rsquo;s the probability lunch is actually Tonkatsu?</p>
<h3 id="the-generative-model">The Generative Model</h3>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@gen</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lunch_with_clue</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Model lunch with a clue about the first letter.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Prior: 50% chance of each meal</span>
</span></span><span style="display:flex;"><span>    is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;is_tonkatsu&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Clue depends on the actual meal</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_tonkatsu:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># If Tonkatsu, definitely says &#34;T&#34;</span>
</span></span><span style="display:flex;"><span>        says_t <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">1.0</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;says_t&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># If Hamburger, only 30% chance of saying &#34;T&#34;</span>
</span></span><span style="display:flex;"><span>        says_t <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.3</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;says_t&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> is_tonkatsu</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="prior-before-hearing-the-clue">Prior (Before Hearing the Clue)</h3>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate without observations</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_prior</span>(k):
</span></span><span style="display:flex;"><span>    trace <span style="color:#f92672">=</span> lunch_with_clue<span style="color:#f92672">.</span>simulate(k, ())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>prior_samples <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_prior)(keys)
</span></span><span style="display:flex;"><span>prob_tonkatsu_prior <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>mean(prior_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Prior: P(Tonkatsu) = </span><span style="color:#e6db74">{</span>prob_tonkatsu_prior<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Prior: P(Tonkatsu) = 0.500</code></pre></div>
<p><strong>Makes sense!</strong> Before hearing the clue, it&rsquo;s 50-50.</p>
<h3 id="posterior-after-hearing-t">Posterior (After Hearing &ldquo;T&rdquo;)</h3>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> genjax <span style="color:#f92672">import</span> ChoiceMap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Observation: heard &#34;T&#34;</span>
</span></span><span style="display:flex;"><span>observations <span style="color:#f92672">=</span> ChoiceMap({<span style="color:#e6db74">&#34;says_t&#34;</span>: <span style="color:#ae81ff">1</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate conditional on observation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_posterior</span>(k):
</span></span><span style="display:flex;"><span>    trace, weight <span style="color:#f92672">=</span> lunch_with_clue<span style="color:#f92672">.</span>generate(k, (), observations)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>posterior_samples <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_posterior)(keys)
</span></span><span style="display:flex;"><span>prob_tonkatsu_posterior <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>mean(posterior_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Posterior: P(Tonkatsu | heard &#39;T&#39;) = </span><span style="color:#e6db74">{</span>prob_tonkatsu_posterior<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Posterior: P(Tonkatsu | heard &#39;T&#39;) = 0.769</code></pre></div>
<p><strong>Perfect!</strong> This matches the theoretical answer from Bayes&rsquo; theorem:</p>
<p>$$P(T \mid \text{heard &ldquo;T&rdquo;}) = \frac{P(\text{heard &ldquo;T&rdquo;} \mid T) \cdot P(T)}{P(\text{heard &ldquo;T&rdquo;})} = \frac{1.0 \times 0.5}{0.65} \approx 0.769$$</p>
<p><strong>The probability increased from 50% to 77%</strong> after hearing the clue!</p>
<hr>
<h2 id="visualizing-prior-vs-posterior">Visualizing Prior vs Posterior</h2>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Data</span>
</span></span><span style="display:flex;"><span>categories <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Hamburger&#39;</span>, <span style="color:#e6db74">&#39;Tonkatsu&#39;</span>]
</span></span><span style="display:flex;"><span>prior_probs <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> prob_tonkatsu_prior, prob_tonkatsu_prior]
</span></span><span style="display:flex;"><span>posterior_probs <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> prob_tonkatsu_posterior, prob_tonkatsu_posterior]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot</span>
</span></span><span style="display:flex;"><span>fig, (ax1, ax2) <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prior</span>
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>bar(categories, prior_probs, color<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#ff6b6b&#39;</span>, <span style="color:#e6db74">&#39;#4ecdc4&#39;</span>])
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Probability&#39;</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Prior: Before Hearing Clue&#39;</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>axhline(y<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, prob <span style="color:#f92672">in</span> enumerate(prior_probs):
</span></span><span style="display:flex;"><span>    ax1<span style="color:#f92672">.</span>text(i, prob <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.05</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>prob<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bold&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Posterior</span>
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>bar(categories, posterior_probs, color<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#ff6b6b&#39;</span>, <span style="color:#e6db74">&#39;#4ecdc4&#39;</span>])
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Probability&#39;</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Posterior: After Hearing &#34;T&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>axhline(y<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, prob <span style="color:#f92672">in</span> enumerate(posterior_probs):
</span></span><span style="display:flex;"><span>    ax2<span style="color:#f92672">.</span>text(i, prob <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.05</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>prob<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bold&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>The visualization shows:</strong> Evidence shifts our belief! We started at 50-50, but hearing &ldquo;T&rdquo; pushed us to 77% Tonkatsu.</p>
<hr>
<h2 id="key-concepts">Key Concepts</h2>
<h3 id="prior-distribution">Prior Distribution</h3>
<p><strong>What we believe before seeing data.</strong></p>
<ul>
<li>Generated by <code>simulate()</code> (no observations)</li>
<li>Represents our initial uncertainty</li>
</ul>
<h3 id="posterior-distribution">Posterior Distribution</h3>
<p><strong>What we believe after seeing data.</strong></p>
<ul>
<li>Generated by <code>generate()</code> with observations</li>
<li>Represents updated beliefs incorporating evidence</li>
</ul>
<h3 id="bayes-theorem-in-action">Bayes&rsquo; Theorem in Action</h3>
<p>GenJAX automatically handles the math:</p>
<p>$$P(\text{hypothesis} \mid \text{data}) = \frac{P(\text{data} \mid \text{hypothesis}) \cdot P(\text{hypothesis})}{P(\text{data})}$$</p>
<p><strong>You just:</strong></p>
<ol>
<li>Define the generative model (encodes $P(\text{data} \mid \text{hypothesis})$ and $P(\text{hypothesis})$)</li>
<li>Specify observations (the data)</li>
<li>Generate conditional traces (GenJAX computes the posterior)</li>
</ol>
<p><strong>No manual Bayes&rsquo; rule calculation needed!</strong></p>

<details open class=" box cstyle notices " style=";--VARIABLE-BOX-color: success">
  <summary class="box-label" tabindex="-1">
    The Power of Generative Models
  </summary>
  <div class="box-content">
<p>When you write a generative function, you&rsquo;re specifying:</p>
<ul>
<li><strong>Prior:</strong> The distribution of random choices before observations</li>
<li><strong>Likelihood:</strong> How observations depend on hidden variables</li>
<li><strong>Joint distribution:</strong> The complete probabilistic model</li>
</ul>
<p>GenJAX handles the inference automatically!</p>
  </div>
</details>
<hr>
<h2 id="exercises">Exercises</h2>
<h3 id="exercise-1-independent-variables">Exercise 1: Independent Variables</h3>
<p>Verify that lunch and dinner are independent:</p>
<p><strong>Task:</strong> Show that $P(\text{lunch}=T \mid \text{dinner}=T) = P(\text{lunch}=T)$</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate unconditional samples (prior)</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_prior</span>(k):
</span></span><span style="display:flex;"><span>    trace <span style="color:#f92672">=</span> chibany_day<span style="color:#f92672">.</span>simulate(k, ())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>days <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_prior)(keys)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prior: P(lunch=T)</span>
</span></span><span style="display:flex;"><span>prob_lunch_prior <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>mean(days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Conditional: P(lunch=T | dinner=T)</span>
</span></span><span style="display:flex;"><span>dinner_t <span style="color:#f92672">=</span> days[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>prob_lunch_given_dinner <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum((days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> dinner_t) <span style="color:#f92672">/</span> jnp<span style="color:#f92672">.</span>sum(dinner_t)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(lunch=T) = </span><span style="color:#e6db74">{</span>prob_lunch_prior<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(lunch=T | dinner=T) = </span><span style="color:#e6db74">{</span>prob_lunch_given_dinner<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Independent: </span><span style="color:#e6db74">{</span>abs(prob_lunch_prior <span style="color:#f92672">-</span> prob_lunch_given_dinner) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.05</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Expected Output
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>P(lunch=T) = 0.500
P(lunch=T | dinner=T) = 0.500
Independent: True</code></pre></div>
<p><strong>Conclusion:</strong> Knowing dinner doesn&rsquo;t change lunch probability ‚Üí independent!</p>
  </div>
</details>
<hr>
<h3 id="exercise-2-dependent-variables">Exercise 2: Dependent Variables</h3>
<p>Create a model where lunch and dinner are <strong>not</strong> independent:</p>
<p><strong>Scenario:</strong> If lunch is Tonkatsu, Chibany wants variety for dinner (only 20% chance of Tonkatsu again). If lunch is Hamburger, he craves Tonkatsu for dinner (80% chance).</p>
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@gen</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chibany_day_dependent</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Meals where dinner depends on lunch.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Lunch is random (50-50)</span>
</span></span><span style="display:flex;"><span>    lunch_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;lunch&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Dinner depends on lunch!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> lunch_is_tonkatsu:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Had Tonkatsu for lunch ‚Üí wants variety</span>
</span></span><span style="display:flex;"><span>        dinner_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.2</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;dinner&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Had Hamburger for lunch ‚Üí craves Tonkatsu</span>
</span></span><span style="display:flex;"><span>        dinner_is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.8</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;dinner&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (lunch_is_tonkatsu, dinner_is_tonkatsu)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Task:</strong> Calculate $P(\text{lunch}=T \mid \text{dinner}=T)$ and compare to $P(\text{lunch}=T)$.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Prior: P(lunch=T)</span>
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_prior</span>(k):
</span></span><span style="display:flex;"><span>    trace <span style="color:#f92672">=</span> chibany_day_dependent<span style="color:#f92672">.</span>simulate(k, ())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>days <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_prior)(keys)
</span></span><span style="display:flex;"><span>prob_lunch_prior <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>mean(days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Conditional: P(lunch=T | dinner=T)</span>
</span></span><span style="display:flex;"><span>dinner_t <span style="color:#f92672">=</span> days[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>prob_lunch_given_dinner <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>sum((days[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> dinner_t) <span style="color:#f92672">/</span> jnp<span style="color:#f92672">.</span>sum(dinner_t)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(lunch=T) = </span><span style="color:#e6db74">{</span>prob_lunch_prior<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(lunch=T | dinner=T) = </span><span style="color:#e6db74">{</span>prob_lunch_given_dinner<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Independent: </span><span style="color:#e6db74">{</span>abs(prob_lunch_prior <span style="color:#f92672">-</span> prob_lunch_given_dinner) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.05</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Expected output:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>P(lunch=T) = 0.500
P(lunch=T | dinner=T) = 0.200
Independent: False</code></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li>Unconditionally, lunch is 50-50</li>
<li>But if we know dinner=T, it&rsquo;s more likely lunch was H (because T‚ÜíT is only 20%)!</li>
<li>So $P(\text{lunch}=T \mid \text{dinner}=T) = 0.2 \neq 0.5 = P(\text{lunch}=T)$</li>
</ul>
<p><strong>They&rsquo;re dependent!</strong> Knowing dinner tells us about lunch.</p>
  </div>
</details>
<hr>
<h3 id="exercise-3-multiple-observations">Exercise 3: Multiple Observations</h3>
<p>Extend the lunch clue model to multiple observations:</p>
<p><strong>Scenario:</strong></p>
<ol>
<li>Student says &ldquo;It starts with T&rdquo;</li>
<li>You smell the food and it smells fried (90% if Tonkatsu, 50% if Hamburger)</li>
</ol>
<p><strong>Task:</strong> Calculate $P(\text{Tonkatsu} \mid \text{says T AND smells fried})$</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@gen</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lunch_with_multiple_clues</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Model with two pieces of evidence.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    is_tonkatsu <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;is_tonkatsu&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Clue 1: What they say</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_tonkatsu:
</span></span><span style="display:flex;"><span>        says_t <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">1.0</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;says_t&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        says_t <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.3</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;says_t&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Clue 2: Smell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_tonkatsu:
</span></span><span style="display:flex;"><span>        smells_fried <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.9</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;smells_fried&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        smells_fried <span style="color:#f92672">=</span> bernoulli(<span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">@</span> <span style="color:#e6db74">&#34;smells_fried&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> is_tonkatsu
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Observations: both clues</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> genjax <span style="color:#f92672">import</span> ChoiceMap
</span></span><span style="display:flex;"><span>observations <span style="color:#f92672">=</span> ChoiceMap({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;says_t&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;smells_fried&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate posterior samples</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>key(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>split(key, <span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_posterior</span>(k):
</span></span><span style="display:flex;"><span>    trace, weight <span style="color:#f92672">=</span> lunch_with_multiple_clues<span style="color:#f92672">.</span>generate(k, (), observations)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> trace<span style="color:#f92672">.</span>get_retval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>posterior <span style="color:#f92672">=</span> jax<span style="color:#f92672">.</span>vmap(run_posterior)(keys)
</span></span><span style="display:flex;"><span>prob_tonkatsu <span style="color:#f92672">=</span> jnp<span style="color:#f92672">.</span>mean(posterior)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P(Tonkatsu | says T AND smells fried) = </span><span style="color:#e6db74">{</span>prob_tonkatsu<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></td></tr></table>
</div>
</div>
<p><strong>Expected:</strong> Higher than 0.769 (from single clue) because we have more evidence!</p>
  </div>
</details>
<hr>
<h2 id="what-youve-learned">What You&rsquo;ve Learned</h2>
<p>In this chapter, you learned:</p>
<p>‚úÖ <strong>Conditional probability</strong> ‚Äî restriction to observations
‚úÖ <strong>Filtering approach</strong> ‚Äî rejection sampling for inference
‚úÖ <strong><code>generate()</code> function</strong> ‚Äî conditioning with choice maps
‚úÖ <strong>Prior vs Posterior</strong> ‚Äî beliefs before and after data
‚úÖ <strong>Bayes&rsquo; theorem in action</strong> ‚Äî automatic Bayesian update
‚úÖ <strong>Dependent vs Independent</strong> ‚Äî how observations provide information</p>
<p><strong>The key insight:</strong> Probabilistic programming lets you <strong>ask questions</strong> instead of just <strong>generate samples</strong>!</p>
<hr>
<h2 id="next-steps">Next Steps</h2>
<p>You now know how to:</p>
<ul>
<li>Generate samples (simulation)</li>
<li>Condition on observations (inference)</li>
<li>Calculate conditional probabilities</li>
</ul>
<p><strong>Next up:</strong> Chapter 5 applies these ideas to a real problem ‚Äî the taxicab scenario from the probability tutorial!</p>
<p>You&rsquo;ll see how Bayes&rsquo; theorem solves practical inference problems, and why base rates matter.</p>
<hr>
<table>
  <thead>
      <tr>
          <th style="text-align: left"><a href="/probintro/genjax/03_traces/index.html">‚Üê Previous: Understanding Traces</a></th>
          <th style="text-align: right"><a href="/probintro/genjax/05_inference/index.html">Next: Inference in Action ‚Üí</a></th>
      </tr>
  </thead>
  <tbody>
  </tbody>
</table>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/probintro/index.html">
            <div class="logo-title">Probability &amp; Probabilistic Computing Tutorial</div>
          </a>
        </div>
        <search><form action="/probintro/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/probintro/index.html"><a class="padding" href="/probintro/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="alwaysopen " data-nav-id="/probintro/intro/index.html"><a class="padding" href="/probintro/intro/index.html">A Narrative Introduction to Probability</a><ul id="R-subsections-58f2a84c91d5deefe8bdd3a21213404a" class="collapsible-menu"></ul></li>
            <li class="parent alwaysopen " data-nav-id="/probintro/genjax/index.html"><a class="padding" href="/probintro/genjax/index.html">Probabilistic Programming with GenJAX</a><ul id="R-subsections-40a5f3b764be01351a755ea2f58fc4ae" class="collapsible-menu">
            <li class="" data-nav-id="/probintro/genjax/00_getting_started/index.html"><a class="padding" href="/probintro/genjax/00_getting_started/index.html">Getting Started with Google Colab</a></li>
            <li class="" data-nav-id="/probintro/genjax/01_python_basics/index.html"><a class="padding" href="/probintro/genjax/01_python_basics/index.html">Python Essentials for GenJAX</a></li>
            <li class="" data-nav-id="/probintro/genjax/02_first_model/index.html"><a class="padding" href="/probintro/genjax/02_first_model/index.html">Your First GenJAX Model</a></li>
            <li class="" data-nav-id="/probintro/genjax/03_traces/index.html"><a class="padding" href="/probintro/genjax/03_traces/index.html">Understanding Traces</a></li>
            <li class="active " data-nav-id="/probintro/genjax/04_conditioning/index.html"><a class="padding" href="/probintro/genjax/04_conditioning/index.html">Conditioning and Observations</a></li>
            <li class="" data-nav-id="/probintro/genjax/05_inference/index.html"><a class="padding" href="/probintro/genjax/05_inference/index.html">Inference in Action: The Taxicab Problem</a></li>
            <li class="" data-nav-id="/probintro/genjax/06_building_models/index.html"><a class="padding" href="/probintro/genjax/06_building_models/index.html">Building Your Own Models</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/probintro/intro2/index.html"><a class="padding" href="/probintro/intro2/index.html">Continuous Probability and Bayesian Learning</a><ul id="R-subsections-6e37e5026001eb89123afab26613c1bf" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/probintro/glossary/index.html"><a class="padding" href="/probintro/glossary/index.html">Glossary - All Tutorials</a></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="/probintro/js/mathjax/tex-mml-chtml.js?1763027978"></script>
    <script src="/probintro/js/clipboard/clipboard.min.js?1763027978" defer></script>
    <script src="/probintro/js/perfect-scrollbar/perfect-scrollbar.min.js?1763027978" defer></script>
    <script src="/probintro/js/theme.min.js?1763027978" defer></script>
  </body>
</html>
